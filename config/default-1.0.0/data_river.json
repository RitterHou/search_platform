{
  "rivers": [
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "topic": "t.qmpc.ItemChange",
        "sla": {
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\""
            }
          },
          "redo": true
        }
      },
      "branches": [
        {
          "name": "yun_not_edit",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":[02])|(\"sys\":[02][\\d\\D]*\"type\":\"add\")|(\"type\":\"update\"[\\d\\D]*\"sys\":[02])|(\"sys\":[02][\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "not",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "version": "1.0.0",
            "service_interface": "com.qianmi.pc.es.api.EsGoodsQueryProvider",
            "request": {
              "method": "listByIdString",
              "timeout": 30,
              "body": {
                "chainMasterId": "{adminId}",
                "idString": "{ids}"
              }
            }
          },
          "destination": [
            {
              "router": {
                "type": "vip_router",
                "fields": {
                  "adminId": "{adminId}",
                  "hashcode": {}
                },
                "target": [
                  {
                    "destination_type": "elasticsearch",
                    "reference": "product_vip",
                    "operation": "create",
                    "id": "{skuId}",
                    "tag": "vip"
                  },
                  {
                    "destination_type": "elasticsearch",
                    "reference": "product_experience",
                    "operation": "create",
                    "id": "{skuId}",
                    "tag": "default"
                  }
                ]
              }
            }
          ]
        },
        {
          "name": "yun_edit_add",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":[02])|(\"sys\":[02][\\d\\D]*\"type\":\"add\")|(\"type\":\"update\"[\\d\\D]*\"sys\":[02])|(\"sys\":[02][\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"addSkuIds\":\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"addSkuIds\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.pc.es.api.EsGoodsQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "listByIdString",
              "timeout": 30,
              "body": {
                "chainMasterId": "{adminId}",
                "idString": "{ids}"
              }
            }
          },
          "destination": [
            {
              "router": {
                "type": "vip_router",
                "fields": {
                  "adminId": "{adminId}"
                },
                "target": [
                  {
                    "destination_type": "elasticsearch",
                    "reference": "product_vip",
                    "operation": "create",
                    "id": "{skuId}",
                    "tag": "vip"
                  },
                  {
                    "destination_type": "elasticsearch",
                    "reference": "product_experience",
                    "operation": "create",
                    "id": "{skuId}",
                    "tag": "default"
                  }
                ]
              }
            }
          ]
        },
        {
          "name": "yun_edit_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":[02])|(\"sys\":[02][\\d\\D]*\"type\":\"add\")|(\"type\":\"update\"[\\d\\D]*\"sys\":[02])|(\"sys\":[02][\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"updateSkuIds\":\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"updateSkuIds\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.pc.es.api.EsGoodsQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "listByIdString",
              "timeout": 30,
              "body": {
                "chainMasterId": "{adminId}",
                "idString": "{ids}"
              }
            }
          },
          "destination": [
            {
              "router": {
                "type": "vip_router",
                "fields": {
                  "adminId": "{adminId}"
                },
                "target": [
                  {
                    "destination_type": "elasticsearch",
                    "reference": "product_vip",
                    "operation": "create",
                    "id": "{skuId}",
                    "tag": "vip"
                  },
                  {
                    "destination_type": "elasticsearch",
                    "reference": "product_experience",
                    "operation": "create",
                    "id": "{skuId}",
                    "tag": "default"
                  }
                ]
              }
            }
          ]
        },
        {
          "name": "yun_edit_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"deleteSkuIds\":\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"sys\":[02]"
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"deleteSkuIds\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "passthrough",
            "fields_reference": "fields"
          },
          "destination": [
            {
              "router": {
                "type": "vip_router",
                "fields": {
                  "adminId": "{adminId}"
                },
                "target": [
                  {
                    "destination_type": "elasticsearch",
                    "reference": "product_vip",
                    "operation": "delete",
                    "id": "{ids}",
                    "id_process": {
                      "type": "seperate",
                      "separator": ":"
                    },
                    "tag": "vip"
                  },
                  {
                    "destination_type": "elasticsearch",
                    "reference": "product_experience",
                    "operation": "delete",
                    "id": "{ids}",
                    "id_process": {
                      "type": "seperate",
                      "separator": ":"
                    },
                    "tag": "default"
                  }
                ]
              }
            }
          ]
        },
        {
          "name": "spu_yun_not_edit",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":[02])|(\"sys\":[02][\\d\\D]*\"type\":\"add\")|(\"type\":\"update\"[\\d\\D]*\"sys\":[02])|(\"sys\":[02][\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "not",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "version": "1.0.0",
            "service_interface": "com.qianmi.pc.es.api.EsProductQueryProvider",
            "request": {
              "method": "listByIdString",
              "timeout": 30,
              "body": {
                "chainMasterId": "{adminId}",
                "idString": "{ids}"
              }
            }
          },
          "destination": [
            {
              "router": {
                "type": "vip_router",
                "fields": {
                  "adminId": "{adminId}"
                },
                "target": [
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_vip",
                    "operation": "create",
                    "id": "{spuId}",
                    "tag": "vip"
                  },
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_experience",
                    "operation": "create",
                    "id": "{spuId}",
                    "tag": "default"
                  }
                ]
              }
            }
          ]
        },
        {
          "name": "spu_yun_edit_add",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":[02])|(\"sys\":[02][\\d\\D]*\"type\":\"add\")|(\"type\":\"update\"[\\d\\D]*\"sys\":[02])|(\"sys\":[02][\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"addSkuIds\":\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"addSkuIds\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.pc.es.api.EsProductQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "listByIdString",
              "timeout": 30,
              "body": {
                "chainMasterId": "{adminId}",
                "idString": "{ids}"
              }
            }
          },
          "destination": [
            {
              "router": {
                "type": "vip_router",
                "fields": {
                  "adminId": "{adminId}"
                },
                "target": [
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_vip",
                    "operation": "create",
                    "id": "{spuId}",
                    "tag": "vip"
                  },
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_experience",
                    "operation": "create",
                    "id": "{spuId}",
                    "tag": "default"
                  }
                ]
              }
            }
          ]
        },
        {
          "name": "spu_yun_edit_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":[02])|(\"sys\":[02][\\d\\D]*\"type\":\"add\")|(\"type\":\"update\"[\\d\\D]*\"sys\":[02])|(\"sys\":[02][\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"updateSkuIds\":\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"updateSkuIds\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.pc.es.api.EsProductQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "listByIdString",
              "timeout": 30,
              "body": {
                "chainMasterId": "{adminId}",
                "idString": "{ids}"
              }
            }
          },
          "destination": [
            {
              "router": {
                "type": "vip_router",
                "fields": {
                  "adminId": "{adminId}"
                },
                "target": [
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_vip",
                    "operation": "create",
                    "id": "{spuId}",
                    "tag": "vip"
                  },
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_experience",
                    "operation": "create",
                    "id": "{spuId}",
                    "tag": "default"
                  }
                ]
              }
            }
          ]
        },
        {
          "name": "spu_yun_edit_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"delete\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"sys\":[02]"
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_spuids_from_pc_mq_msg",
                  "input_param": {
                    "fields": {
                      "pc_ids": {
                        "type": "regex",
                        "expression": "\"ids\":\"(?P<pc_ids>[\\d\\D]+?)\""
                      },
                      "sep_char": {
                        "type": "fixed",
                        "expression": ","
                      }
                    }
                  }
                },
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "passthrough",
            "fields_reference": "fields"
          },
          "destination": [
            {
              "router": {
                "type": "vip_router",
                "fields": {
                  "adminId": "{adminId}"
                },
                "target": [
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_vip",
                    "operation": "delete",
                    "id": "{ids}",
                    "id_process": {
                      "type": "seperate",
                      "separator": ","
                    },
                    "tag": "vip"
                  },
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_experience",
                    "operation": "delete",
                    "id": "{ids}",
                    "id_process": {
                      "type": "seperate",
                      "separator": ","
                    },
                    "tag": "default"
                  }
                ]
              }
            }
          ]
        },
        {
          "name": "sup_not_edit",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"add\")|(\"type\":\"update\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "not",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "skuIds": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_skuids_from_pc_mq_msg",
                  "input_param": {
                    "fields": {
                      "pc_ids": {
                        "type": "regex",
                        "expression": "\"ids\":\"(?P<pc_ids>[\\d\\D]+?)\""
                      },
                      "sep_char": {
                        "type": "fixed",
                        "expression": ","
                      }
                    }
                  }
                },
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/supGoods/getSupGoodsInfoList",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "skuIds": "{skuIds}",
                "adminId": "{adminId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "create",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_edit_add",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"add\")|(\"type\":\"update\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"addSkuIds\":\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"addSkuIds\":\"(?P<ids>[\\d\\D]+?)\"",
                "skuIds": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_skuids_from_pc_mq_msg",
                  "input_param": {
                    "fields": {
                      "pc_ids": {
                        "type": "regex",
                        "expression": "\"addSkuIds\":\"(?P<pc_ids>[\\d\\D]+?)\""
                      },
                      "sep_char": {
                        "type": "fixed",
                        "expression": ","
                      }
                    }
                  }
                },
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/supGoods/getSupGoodsInfoList",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "skuIds": "{skuIds}",
                "adminId": "{adminId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "create",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_edit_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"add\")|(\"type\":\"update\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"updateSkuIds\":\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"updateSkuIds\":\"(?P<ids>[\\d\\D]+?)\"",
                "skuIds": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_skuids_from_pc_mq_msg",
                  "input_param": {
                    "fields": {
                      "pc_ids": {
                        "type": "regex",
                        "expression": "\"updateSkuIds\":\"(?P<pc_ids>[\\d\\D]+?)\""
                      },
                      "sep_char": {
                        "type": "fixed",
                        "expression": ","
                      }
                    }
                  }
                },
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/supGoods/getSupGoodsInfoList",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "skuIds": "{skuIds}",
                "adminId": "{adminId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "create",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_edit_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"deleteSkuIds\":\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"sys\":1"
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"deleteSkuIds\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "passthrough",
            "fields_reference": "fields"
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "delete",
              "id": "{ids}"
            }
          ]
        },
        {
          "name": "spu_sup_not_edit",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"add\")|(\"type\":\"update\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "not",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "spuIds": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_spuids_from_pc_mq_msg",
                  "input_param": {
                    "fields": {
                      "pc_ids": {
                        "type": "regex",
                        "expression": "\"ids\":\"(?P<pc_ids>[\\d\\D]+?)\""
                      },
                      "sep_char": {
                        "type": "fixed",
                        "expression": ","
                      }
                    }
                  }
                },
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/gonghuoGoods/getSupGoodsInfoList",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "spuIds": "{spuIds}",
                "adminId": "{adminId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_spu",
              "operation": "create",
              "id": "{spuId}"
            }
          ]
        },
        {
          "name": "spu_sup_edit_add",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"add\")|(\"type\":\"update\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"addSkuIds\":\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"addSkuIds\":\"(?P<ids>[\\d\\D]+?)\"",
                "spuIds": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_spuids_from_pc_mq_msg",
                  "input_param": {
                    "fields": {
                      "pc_ids": {
                        "type": "regex",
                        "expression": "\"addSkuIds\":\"(?P<pc_ids>[\\d\\D]+?)\""
                      },
                      "sep_char": {
                        "type": "fixed",
                        "expression": ","
                      }
                    }
                  }
                },
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/gonghuoGoods/getSupGoodsInfoList",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "spuIds": "{spuIds}",
                "adminId": "{adminId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_spu",
              "operation": "create",
              "id": "{spuId}"
            }
          ]
        },
        {
          "name": "spu_sup_edit_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"add\")|(\"type\":\"update\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"updateSkuIds\":\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"updateSkuIds\":\"(?P<ids>[\\d\\D]+?)\"",
                "spuIds": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_spuids_from_pc_mq_msg",
                  "input_param": {
                    "fields": {
                      "pc_ids": {
                        "type": "regex",
                        "expression": "\"updateSkuIds\":\"(?P<pc_ids>[\\d\\D]+?)\""
                      },
                      "sep_char": {
                        "type": "fixed",
                        "expression": ","
                      }
                    }
                  }
                },
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/gonghuoGoods/getSupGoodsInfoList",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "spuIds": "{spuIds}",
                "adminId": "{adminId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_spu",
              "operation": "create",
              "id": "{spuId}"
            }
          ]
        },
        {
          "name": "spu_sup_edit_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"deleteSkuIds\":\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"sys\":1"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_spuids_from_pc_mq_msg",
                  "input_param": {
                    "fields": {
                      "pc_ids": {
                        "type": "regex",
                        "expression": "\"ids\":\"(?P<pc_ids>[\\d\\D]+?)\""
                      },
                      "sep_char": {
                        "type": "fixed",
                        "expression": ","
                      }
                    }
                  }
                },
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "passthrough",
            "fields_reference": "fields"
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_spu",
              "operation": "delete",
              "id": "{ids}"
            }
          ]
        }
      ]
    },
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "queue": "q.qmpc.EsInit",
        "sla": {
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\""
            }
          }
        }
      },
      "branches": [
        {
          "name": "yun_init",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"sys\":[02]"
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "fromSys": "sys\":(?P<fromSys>[\\d]+?)",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.pc.es.api.EsGoodsQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "query",
              "timeout": 30,
              "body": {
                "chainMasterId": "{adminId}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "fromSys": "{fromSys}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "router": {
                "type": "vip_router",
                "fields": {
                  "adminId": "{adminId}"
                },
                "target": [
                  {
                    "destination_type": "elasticsearch",
                    "reference": "product_vip",
                    "operation": "create",
                    "id": "{skuId}",
                    "clear_policy": "every_msg,all",
                    "tag": "vip"
                  },
                  {
                    "destination_type": "elasticsearch",
                    "reference": "product_experience",
                    "operation": "create",
                    "id": "{skuId}",
                    "clear_policy": "every_msg,by_adminId",
                    "tag": "default"
                  }
                ]
              }
            }
          ]
        },
        {
          "name": "spu_yun_init",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"sys\":[02]"
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "fromSys": "sys\":(?P<fromSys>[\\d]+?)",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.pc.es.api.EsProductQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "query",
              "timeout": 30,
              "body": {
                "chainMasterId": "{adminId}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "fromSys": "{fromSys}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "router": {
                "type": "vip_router",
                "fields": {
                  "adminId": "{adminId}"
                },
                "target": [
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_vip",
                    "operation": "create",
                    "id": "{spuId}",
                    "clear_policy": "every_msg,all",
                    "tag": "vip"
                  },
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_experience",
                    "operation": "create",
                    "id": "{spuId}",
                    "clear_policy": "every_msg,by_adminId",
                    "tag": "default"
                  }
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "topic": "t.qmsup.category.operate",
        "sla": {
          "data_parser": {
            "type": "fixed",
            "fields": {
              "adminId": "gonghuo"
            }
          },
          "redo": true
        }
      },
      "branches": [
        {
          "name": "sup_init",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=init"
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {}
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/supGoods/getSupGoodsInfoPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "create",
              "id": "{skuId}",
              "clear_policy": "every_msg,all"
            }
          ]
        },
        {
          "name": "sup_show_cate_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=update"
                },
                {
                  "type": "regex",
                  "expression": "oldCateId="
                },
                {
                  "type": "regex",
                  "expression": "cateId="
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "oldCateId": "oldCateId=(?P<oldCateId>[\\d\\D]+?),",
                "cateId": "cateId=(?P<cateId>[\\d\\D]+?)}"
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/supGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "oldCateId": "{oldCateId}",
                "cateId": "{cateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "update",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_show_cate_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=delete"
                },
                {
                  "type": "regex",
                  "expression": "cateId="
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "cateId": "cateId=(?P<cateId>[\\d\\D]+?)}"
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/supGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "cateId": "{cateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "update",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_show_cate_add",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=add"
                },
                {
                  "type": "regex",
                  "expression": "cateId="
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "cateId": "cateId=(?P<cateId>[\\d\\D]+?)}"
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/supGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "cateId": "{cateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "update",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_cate_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=update"
                },
                {
                  "type": "regex",
                  "expression": "oldCateId="
                },
                {
                  "type": "regex",
                  "expression": "cateId="
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "oldCateId": "oldCateId=(?P<oldCateId>[\\d\\D]+?),",
                "cateId": "cateId=(?P<cateId>[\\d\\D]+?)}"
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/supGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "oldCateId": "{oldCateId}",
                "cateId": "{cateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "update",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "spu_sup_init",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=init"
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {}
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/gonghuoGoods/getSupGoodsInfoPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_spu",
              "operation": "create",
              "id": "{spuId}",
              "clear_policy": "every_msg,all"
            }
          ]
        },
        {
          "name": "spu_sup_show_cate_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=update"
                },
                {
                  "type": "regex",
                  "expression": "oldCateId="
                },
                {
                  "type": "regex",
                  "expression": "cateId="
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "oldCateId": "oldCateId=(?P<oldCateId>[\\d\\D]+?),",
                "cateId": "cateId=(?P<cateId>[\\d\\D]+?)}"
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/gonghuoGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "oldCateId": "{oldCateId}",
                "cateId": "{cateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_spu",
              "operation": "update",
              "id": "{spuId}"
            }
          ]
        },
        {
          "name": "spu_sup_show_cate_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=delete"
                },
                {
                  "type": "regex",
                  "expression": "cateId="
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "cateId": "cateId=(?P<cateId>[\\d\\D]+?)}"
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/gonghuoGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "cateId": "{cateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_spu",
              "operation": "update",
              "id": "{spuId}"
            }
          ]
        },
        {
          "name": "spu_sup_show_cate_add",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=add"
                },
                {
                  "type": "regex",
                  "expression": "cateId="
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "cateId": "cateId=(?P<cateId>[\\d\\D]+?)}"
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/gonghuoGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "cateId": "{cateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_spu",
              "operation": "update",
              "id": "{spuId}"
            }
          ]
        },
        {
          "name": "spu_sup_cate_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=update"
                },
                {
                  "type": "regex",
                  "expression": "oldCateId="
                },
                {
                  "type": "regex",
                  "expression": "cateId="
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "oldCateId": "oldCateId=(?P<oldCateId>[\\d\\D]+?),",
                "cateId": "cateId=(?P<cateId>[\\d\\D]+?)}"
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/gonghuoGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "oldCateId": "{oldCateId}",
                "cateId": "{cateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_spu",
              "operation": "update",
              "id": "{spuId}"
            }
          ]
        }
      ]
    },
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "topic": "t.qmpc.standardCateChange",
        "sla": {
          "data_parser": {
            "type": "fixed",
            "fields": {
              "adminId": "gonghuo"
            }
          },
          "redo": true
        }
      },
      "branches": [
        {
          "name": "sup_standard_cate_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"update\"|\"type\":\"updateStatus\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "type": "\"type\":\"(?P<type>[\\d\\D]+?)\"",
                "parentCateId": "parentCateId\":\"(?P<parentCateId>[\\d\\D]+?)\"",
                "cateId": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_cateIds_from_standard_cate_update_msg"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/supGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "type": "{type}",
                "cateId": "{cateId}",
                "parentCateId": "{parentCateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "update",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_standard_cate_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "type": "\"type\":\"(?P<type>[\\d\\D]+?)\"",
                "parentCateId": "parentCateId\":\"(?P<parentCateId>[\\d\\D]+?)\"",
                "cateId": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_cateIds_from_standard_cate_update_msg"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/supGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "type": "{type}",
                "cateId": "{cateId}",
                "parentCateId": "{parentCateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "update",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "spu_sup_standard_cate_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"update\"|\"type\":\"updateStatus\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "type": "\"type\":\"(?P<type>[\\d\\D]+?)\"",
                "parentCateId": "parentCateId\":\"(?P<parentCateId>[\\d\\D]+?)\"",
                "cateId": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_cateIds_from_standard_cate_update_msg"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/gonghuoGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "type": "{type}",
                "cateId": "{cateId}",
                "parentCateId": "{parentCateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_spu",
              "operation": "update",
              "id": "{spuId}"
            }
          ]
        },
        {
          "name": "spu_sup_standard_cate_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "type": "\"type\":\"(?P<type>[\\d\\D]+?)\"",
                "parentCateId": "parentCateId\":\"(?P<parentCateId>[\\d\\D]+?)\"",
                "cateId": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_cateIds_from_standard_cate_update_msg"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "{gonghuo_http_host}",
            "request": {
              "url": "/gonghuoGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "type": "{type}",
                "cateId": "{cateId}",
                "parentCateId": "{parentCateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_spu",
              "operation": "update",
              "id": "{spuId}"
            }
          ]
        }
      ]
    },
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "queue": "q.qmpc.ssm.EsInit",
        "sla": {
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminId": "pointUserId\":\"(?P<adminId>[\\d\\D]+?)\""
            }
          }
        }
      },
      "branches": [
        {
          "name": "spu_ssm_init",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": []
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "pointUserId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.pc.api.ssm.es.EsSsmProductQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "query",
              "timeout": 30,
              "body": {
                "pointUserId": "{adminId}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "router": {
                "type": "vip_router",
                "fields": {
                  "adminId": "{adminId}"
                },
                "target": [
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_vip",
                    "operation": "create",
                    "id": "{ssmItemId}",
                    "clear_policy": "every_msg,all",
                    "tag": "vip"
                  },
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_experience",
                    "operation": "create",
                    "id": "{ssmItemId}",
                    "clear_policy": "every_msg,by_adminId",
                    "tag": "default"
                  }
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "topic": "t.ssm.ItemChange",
        "sla": {
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminId": "pointUserId\":\"(?P<adminId>[\\d\\D]+?)\""
            }
          },
          "redo": true
        }
      },
      "branches": [
        {
          "name": "spu_ssm_add",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"add\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "pointUserId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "version": "1.0.0",
            "service_interface": "com.qianmi.pc.api.ssm.es.EsSsmProductQueryProvider",
            "request": {
              "method": "listSsmProductByIds",
              "timeout": 30,
              "body": {
                "pointUserId": "{adminId}",
                "productIds": "{ids}"
              }
            }
          },
          "destination": [
            {
              "router": {
                "type": "vip_router",
                "fields": {
                  "adminId": "{adminId}"
                },
                "target": [
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_vip",
                    "operation": "create",
                    "id": "{ssmItemId}",
                    "tag": "vip"
                  },
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_experience",
                    "operation": "create",
                    "id": "{ssmItemId}",
                    "tag": "default"
                  }
                ]
              }
            }
          ]
        },
        {
          "name": "spu_ssm_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"update\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "pointUserId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "version": "1.0.0",
            "service_interface": "com.qianmi.pc.api.ssm.es.EsSsmProductQueryProvider",
            "request": {
              "method": "listSsmProductByIds",
              "timeout": 30,
              "body": {
                "pointUserId": "{adminId}",
                "productIds": "{ids}"
              }
            }
          },
          "destination": [
            {
              "router": {
                "type": "vip_router",
                "fields": {
                  "adminId": "{adminId}"
                },
                "target": [
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_vip",
                    "operation": "create",
                    "id": "{ssmItemId}",
                    "tag": "vip"
                  },
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_experience",
                    "operation": "create",
                    "id": "{ssmItemId}",
                    "tag": "default"
                  }
                ]
              }
            }
          ]
        },
        {
          "name": "spu_ssm_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "pointUserId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "passthrough",
            "fields_reference": "fields"
          },
          "destination": [
            {
              "router": {
                "type": "vip_router",
                "fields": {
                  "adminId": "{adminId}"
                },
                "target": [
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_vip",
                    "operation": "delete",
                    "id": "{ids}",
                    "id_process": {
                      "type": "seperate",
                      "separator": ";"
                    },
                    "tag": "vip"
                  },
                  {
                    "destination_type": "elasticsearch",
                    "reference": "spu_experience",
                    "operation": "delete",
                    "id": "{ids}",
                    "id_process": {
                      "type": "seperate",
                      "separator": ";"
                    },
                    "tag": "default"
                  }
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "topic": "t.cloudshop.platform.initMarketing",
        "sla": {
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\""
            }
          }
        }
      },
      "branches": [
        {
          "name": "cloudshop_marketing_init",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": []
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "domain_type": "domainType\":\"(?P<domain_type>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.cloudshop.api.es.ESMarketingProvider",
            "version": "1.0.0",
            "request": {
              "method": "queryMarketingList4ESearch",
              "timeout": 10,
              "body": {
                "adminId": "{adminId}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "domainType": "{domain_type}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "create",
              "index": "cloudshop-marketing-{hashcode}-{version}",
              "id": "{marketingId}",
              "type": "Marketing",
              "clear_policy": "every_msg,by_adminId",
              "add_admin_id_field": true
            }
          ]
        }
      ]
    },
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "topic": "t.cloudshop.platform.marketingChange",
        "sla": {
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\""
            }
          },
          "redo": true
        }
      },
      "branches": [
        {
          "name": "cloudshop_marketing_add",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"add\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "domain_type": "domainType\":\"(?P<domain_type>[\\d\\D]+?)\"",
                "ids": "\"marketingId\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "version": "1.0.0",
            "service_interface": "com.qianmi.cloudshop.api.es.ESMarketingProvider",
            "request": {
              "method": "queryMarketingList4ESearchByIds",
              "timeout": 10,
              "body": {
                "adminId": "{adminId}",
                "domainType": "{domain_type}",
                "marketingId": "{ids}"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "create",
              "index": "cloudshop-marketing-{hashcode}-{version}",
              "id": "{marketingId}",
              "type": "Marketing",
              "add_admin_id_field": true
            }
          ]
        },
        {
          "name": "cloudshop_marketing_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"update\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "domain_type": "domainType\":\"(?P<domain_type>[\\d\\D]+?)\"",
                "ids": "\"marketingId\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "version": "1.0.0",
            "service_interface": "com.qianmi.cloudshop.api.es.ESMarketingProvider",
            "request": {
              "method": "queryMarketingList4ESearchByIds",
              "timeout": 10,
              "body": {
                "adminId": "{adminId}",
                "domainType": "{domain_type}",
                "marketingId": "{ids}"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "create",
              "index": "cloudshop-marketing-{hashcode}-{version}",
              "id": "{marketingId}",
              "type": "Marketing",
              "add_admin_id_field": true
            }
          ]
        },
        {
          "name": "cloudshop_marketing_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"marketingId\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "passthrough",
            "fields_reference": "fields"
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "delete",
              "index": "cloudshop-marketing-{hashcode}-{version}",
              "type": "Marketing",
              "id": "{ids}",
              "id_process": {
                "type": "seperate",
                "separator": ","
              },
              "add_admin_id_field": true
            }
          ]
        }
      ]
    },
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "queue": "q.search_platform.shopInit",
        "sla": {
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\""
            }
          }
        }
      },
      "branches": [
        {
          "name": "sp_vip_yun_init",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"sys\":[02]"
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "fromSys": "sys\":(?P<fromSys>[\\d]+?)",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.pc.es.api.EsGoodsQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "query",
              "timeout": 30,
              "body": {
                "chainMasterId": "{adminId}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "fromSys": "{fromSys}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "product_vip",
              "operation": "create",
              "id": "{skuId}",
              "clear_policy": "every_msg,all",
              "tag": "vip"
            }
          ]
        },
        {
          "name": "sp_vip_spu_yun_init",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"sys\":[02]"
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "chainMasterId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "fromSys": "sys\":(?P<fromSys>[\\d]+?)",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 50,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.pc.es.api.EsProductQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "query",
              "timeout": 30,
              "body": {
                "chainMasterId": "{adminId}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "fromSys": "{fromSys}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "spu_vip",
              "operation": "create",
              "id": "{spuId}",
              "clear_policy": "every_msg,all",
              "tag": "vip"
            }
          ]
        }
      ]
    },
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "topic": "t.marketing.change",
        "sla": {
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\""
            }
          },
          "redo": true
        }
      },
      "branches": [
        {
          "name": "marketing_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "not",
                  "type": "regex",
                  "expression": "\"operation\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "msgId": "msgId\":\"(?P<msgId>[\\d\\D]+?)\"",
                "domainType": "domainType\":\"(?P<domainType>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "version": "1.0.0",
            "service_interface": "com.qianmi.mc.api.search.SearchActivityQueryProvider",
            "request": {
              "method": "queryMarketingByIds",
              "timeout": 30,
              "body": {
                "adminId": "{adminId}",
                "ids": "{ids}",
                "msgId": "{msgId}",
                "domainType": "{domainType}"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "create",
              "index": "marketing-{hashcode}-{version}",
              "type": "Marketing",
              "id": "{id}",
              "add_admin_id_field": true
            }
          ]
        },
        {
          "name": "marketing_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "passthrough",
            "fields_reference": "fields"
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "delete",
              "index": "marketing-{hashcode}-{version}",
              "type": "Marketing",
              "id": "{ids}",
              "id_process": {
                "type": "seperate",
                "separator": ";"
              },
              "add_admin_id_field": true
            }
          ]
        }
      ]
    },
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "topic": "t.marketing.itemChange",
        "sla": {
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\""
            }
          },
          "redo": true
        }
      },
      "branches": [
        {
          "name": "marketing_item_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "not",
                  "type": "regex",
                  "expression": "\"operation\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "msgId": "msgId\":\"(?P<msgId>[\\d\\D]+?)\"",
                "domainType": "domainType\":\"(?P<domainType>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "version": "1.0.0",
            "service_interface": "com.qianmi.mc.api.search.SearchActivityQueryProvider",
            "request": {
              "method": "queryItemByIds",
              "timeout": 30,
              "body": {
                "adminId": "{adminId}",
                "ids": "{ids}",
                "msgId": "{msgId}",
                "domainType": "{domainType}"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "create",
              "index": "marketing-item-{hashcode}-{version}",
              "type": "Item",
              "id": "{id}",
              "add_admin_id_field": true
            }
          ]
        },
        {
          "name": "marketing_item_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "passthrough",
            "fields_reference": "fields"
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "delete",
              "index": "marketing-item-{hashcode}-{version}",
              "type": "Item",
              "id": "{ids}",
              "id_process": {
                "type": "seperate",
                "separator": ";"
              },
              "add_admin_id_field": true
            }
          ]
        }
      ]
    },
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "topic": "t.marketing.tradeChange",
        "sla": {
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\""
            }
          },
          "redo": true
        }
      },
      "branches": [
        {
          "name": "marketing_trade_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "not",
                  "type": "regex",
                  "expression": "\"operation\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "msgId": "msgId\":\"(?P<msgId>[\\d\\D]+?)\"",
                "domainType": "domainType\":\"(?P<domainType>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "version": "1.0.0",
            "service_interface": "com.qianmi.mc.api.search.SearchActivityQueryProvider",
            "request": {
              "method": "queryTradeMarketingRecordByIds",
              "timeout": 30,
              "body": {
                "adminId": "{adminId}",
                "ids": "{ids}",
                "msgId": "{msgId}",
                "domainType": "{domainType}"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "create",
              "index": "marketing-trade-{hashcode}-{version}",
              "type": "Trade",
              "id": "{tid}",
              "add_admin_id_field": true
            }
          ]
        },
        {
          "name": "marketing_trade_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "passthrough",
            "fields_reference": "fields"
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "delete",
              "index": "marketing-trade-{hashcode}-{version}",
              "type": "Trade",
              "id": "{ids}",
              "id_process": {
                "type": "seperate",
                "separator": ";"
              },
              "add_admin_id_field": true
            }
          ]
        }
      ]
    },
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "topic": "t.marketing.userCouponChange",
        "sla": {
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\""
            }
          },
          "redo": true
        }
      },
      "branches": [
        {
          "name": "marketing_usercoupon_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "not",
                  "type": "regex",
                  "expression": "\"operation\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "msgId": "msgId\":\"(?P<msgId>[\\d\\D]+?)\"",
                "domainType": "domainType\":\"(?P<domainType>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "version": "1.0.0",
            "service_interface": "com.qianmi.mc.api.search.SearchCouponQueryProvider",
            "request": {
              "method": "queryUserCouponByIds",
              "timeout": 30,
              "body": {
                "adminId": "{adminId}",
                "ids": "{ids}",
                "msgId": "{msgId}",
                "domainType": "{domainType}"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "create",
              "index": "marketing-usercoupon-{hashcode}-{version}",
              "type": "Coupon",
              "id": "{couponId}",
              "add_admin_id_field": true
            }
          ]
        },
        {
          "name": "marketing_usercoupon_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "passthrough",
            "fields_reference": "fields"
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "delete",
              "index": "marketing-usercoupon-{hashcode}-{version}",
              "type": "Coupon",
              "id": "{ids}",
              "id_process": {
                "type": "seperate",
                "separator": ";"
              },
              "add_admin_id_field": true
            }
          ]
        }
      ]
    },
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "topic": "t.marketing.fansChange",
        "sla": {
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\""
            }
          },
          "redo": true
        }
      },
      "branches": [
        {
          "name": "marketing_fans_update",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "not",
                  "type": "regex",
                  "expression": "\"operation\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "msgId": "msgId\":\"(?P<msgId>[\\d\\D]+?)\"",
                "domainType": "domainType\":\"(?P<domainType>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "version": "1.0.0",
            "service_interface": "com.qianmi.mc.api.search.SearchFansQueryProvider",
            "request": {
              "method": "queryFansByIds",
              "timeout": 30,
              "body": {
                "adminId": "{adminId}",
                "ids": "{ids}",
                "msgId": "{msgId}",
                "domainType": "{domainType}"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "create",
              "index": "marketing-fans-{hashcode}-{version}",
              "type": "Fans",
              "id": "{openId}",
              "add_admin_id_field": true
            }
          ]
        },
        {
          "name": "marketing_fans_delete",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "passthrough",
            "fields_reference": "fields"
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "delete",
              "index": "marketing-fans-{hashcode}-{version}",
              "type": "Fans",
              "id": "{ids}",
              "id_process": {
                "type": "seperate",
                "separator": ";"
              },
              "add_admin_id_field": true
            }
          ]
        }
      ]
    },
    {
      "notification": {
        "type": "MQ",
        "host": "{mq_host}",
        "queue": "q.searchPlatform.marketingInit",
        "sla": {
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\""
            }
          }
        }
      },
      "branches": [
        {
          "name": "marketing_init",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"marketing\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "msgId": "msgId\":\"(?P<msgId>[\\d\\D]+?)\"",
                "domainType": "domainType\":\"(?P<domainType>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.mc.api.search.SearchActivityQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "queryMarketing",
              "timeout": 10,
              "body": {
                "adminId": "{adminId}",
                "msgId": "{msgId}",
                "domainType": "{domainType}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "create",
              "index": "marketing-{hashcode}-{version}",
              "type": "Marketing",
              "id": "{id}",
              "clear_policy": "every_msg,by_adminId",
              "add_admin_id_field": true
            }
          ]
        },
        {
          "name": "marketing_item_init",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"item\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "msgId": "msgId\":\"(?P<msgId>[\\d\\D]+?)\"",
                "domainType": "domainType\":\"(?P<domainType>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.mc.api.search.SearchActivityQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "queryItem",
              "timeout": 10,
              "body": {
                "adminId": "{adminId}",
                "msgId": "{msgId}",
                "domainType": "{domainType}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "create",
              "index": "marketing-item-{hashcode}-{version}",
              "type": "Item",
              "id": "{id}",
              "clear_policy": "every_msg,by_adminId",
              "add_admin_id_field": true
            }
          ]
        },
        {
          "name": "marketing_trade_init",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"trade\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "msgId": "msgId\":\"(?P<msgId>[\\d\\D]+?)\"",
                "domainType": "domainType\":\"(?P<domainType>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.mc.api.search.SearchActivityQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "queryTradeMarketingRecord",
              "timeout": 10,
              "body": {
                "adminId": "{adminId}",
                "msgId": "{msgId}",
                "domainType": "{domainType}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "create",
              "index": "marketing-trade-{hashcode}-{version}",
              "type": "Trade",
              "id": "{tid}",
              "clear_policy": "every_msg,by_adminId",
              "add_admin_id_field": true
            }
          ]
        },
        {
          "name": "marketing_usercoupon_init",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"usercoupon\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "msgId": "msgId\":\"(?P<msgId>[\\d\\D]+?)\"",
                "domainType": "domainType\":\"(?P<domainType>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.mc.api.search.SearchCouponQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "queryUserCoupon",
              "timeout": 10,
              "body": {
                "adminId": "{adminId}",
                "msgId": "{msgId}",
                "domainType": "{domainType}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "create",
              "index": "marketing-usercoupon-{hashcode}-{version}",
              "type": "Coupon",
              "id": "{couponId}",
              "clear_policy": "every_msg,by_adminId",
              "add_admin_id_field": true
            }
          ]
        },
        {
          "name": "marketing_fans_init",
          "notification": {
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\":\"fans\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminId": "adminId\":\"(?P<adminId>[\\d\\D]+?)\"",
                "msgId": "msgId\":\"(?P<msgId>[\\d\\D]+?)\"",
                "domainType": "domainType\":\"(?P<domainType>[\\d\\D]+?)\"",
                "hashcode": {
                  "type": "hash_modulus",
                  "modulus": 1,
                  "origin_filed": "adminId"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "dubbo",
            "host": "{zookeeper_host}",
            "service_interface": "com.qianmi.mc.api.search.SearchFansQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "queryFans",
              "timeout": 10,
              "body": {
                "adminId": "{adminId}",
                "msgId": "{msgId}",
                "domainType": "{domainType}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "general_experience",
              "operation": "create",
              "index": "marketing-fans-{hashcode}-{version}",
              "type": "Fans",
              "id": "{openId}",
              "clear_policy": "every_msg,by_adminId",
              "add_admin_id_field": true
            }
          ]
        }
      ]
    }
  ]
}