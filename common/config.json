{
  "default": {
    "version": "1.0.0",
    "es_index_setting": {
      "product": {
        "host": "http://192.168.65.131:9200,http://192.168.65.132:9200,http://192.168.65.136:9200",
        "index": "qmshop-{adminID}-{version}",
        "type": "Product",
        "id": "",
        "mapping": {
          "properties": {
            "category": {
              "index": "not_analyzed",
              "type": "string"
            },
            "tags": {
              "analyzer": "standard",
              "term_vector": "with_positions_offsets",
              "type": "string"
            },
            "costPrice": {
              "index": "not_analyzed",
              "type": "double"
            },
            "marketPrice": {
              "index": "not_analyzed",
              "type": "double"
            },
            "onSale": {
              "type": "boolean"
            },
            "weight": {
              "index": "not_analyzed",
              "type": "string"
            },
            "spuId": {
              "index": "not_analyzed",
              "type": "string"
            },
            "type": {
              "index": "not_analyzed",
              "type": "string"
            },
            "salePoint": {
              "analyzer": "standard",
              "term_vector": "with_positions_offsets",
              "type": "string"
            },
            "adminId": {
              "index": "not_analyzed",
              "type": "string"
            },
            "cats": {
              "properties": {
                "id": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "name": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "childs": {
                  "properties": {
                    "id": {
                      "index": "not_analyzed",
                      "type": "string"
                    },
                    "name": {
                      "index": "not_analyzed",
                      "type": "string"
                    },
                    "childs": {
                      "properties": {
                        "id": {
                          "index": "not_analyzed",
                          "type": "string"
                        },
                        "name": {
                          "index": "not_analyzed",
                          "type": "string"
                        },
                        "childs": {
                          "properties": {
                            "id": {
                              "index": "not_analyzed",
                              "type": "string"
                            },
                            "name": {
                              "index": "not_analyzed",
                              "type": "string"
                            },
                            "childs": {
                              "properties": {
                                "id": {
                                  "index": "not_analyzed",
                                  "type": "string"
                                },
                                "name": {
                                  "index": "not_analyzed",
                                  "type": "string"
                                },
                                "childs": {
                                  "properties": {
                                    "id": {
                                      "index": "not_analyzed",
                                      "type": "string"
                                    },
                                    "name": {
                                      "index": "not_analyzed",
                                      "type": "string"
                                    },
                                    "childs": {
                                      "type": "nested"
                                    }
                                  },
                                  "type": "nested"
                                }
                              },
                              "type": "nested"
                            }
                          },
                          "type": "nested"
                        }
                      },
                      "type": "nested"
                    }
                  },
                  "type": "nested"
                }
              },
              "type": "nested"
            },
            "unit": {
              "index": "not_analyzed",
              "type": "string"
            },
            "title": {
              "index_analyzer": "ansj_index",
              "store": true,
              "search_analyzer": "ansj_query",
              "boost": 2,
              "term_vector": "with_positions_offsets",
              "type": "string"
            },
            "stock": {
              "properties": {
                "count": {
                  "index": "not_analyzed",
                  "type": "long"
                },
                "status": {
                  "type": "boolean"
                },
                "name": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "regions": {
                  "properties": {
                    "count": {
                      "index": "no",
                      "type": "long"
                    },
                    "status": {
                      "type": "boolean"
                    },
                    "name": {
                      "index": "not_analyzed",
                      "type": "string"
                    }
                  }
                }
              },
              "type": "nested"
            },
            "skuId": {
              "index": "not_analyzed",
              "type": "string"
            },
            "brand": {
              "index": "not_analyzed",
              "type": "string",
              "boost": 5.0
            },
            "images": {
              "index": "no",
              "type": "string"
            },
            "salePrice": {
              "precision_step": 4,
              "type": "double"
            },
            "props": {
              "properties": {
                "name": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "value": {
                  "index": "not_analyzed",
                  "type": "string"
                }
              },
              "type": "nested"
            }
          },
          "_all": {
            "store": true,
            "analyzer": "standard",
            "auto_boost": true
          }
        }
      },
      "gonghuo_product": {
        "host": "http://192.168.65.131:9200,http://192.168.65.132:9200,http://192.168.65.136:9200",
        "index": "qmshop-gonghuo-{version}",
        "type": "Product",
        "id": "",
        "mapping": {
          "properties": {
            "category": {
              "index": "not_analyzed",
              "type": "string"
            },
            "tags": {
              "analyzer": "standard",
              "term_vector": "with_positions_offsets",
              "type": "string"
            },
            "costPrice": {
              "index": "not_analyzed",
              "type": "double"
            },
            "marketPrice": {
              "index": "not_analyzed",
              "type": "double"
            },
            "onSale": {
              "type": "boolean"
            },
            "weight": {
              "index": "not_analyzed",
              "type": "string"
            },
            "adminId": {
              "index": "not_analyzed",
              "type": "string"
            },
            "spuId": {
              "index": "not_analyzed",
              "type": "string"
            },
            "type": {
              "index": "not_analyzed",
              "type": "string"
            },
            "salePoint": {
              "analyzer": "standard",
              "term_vector": "with_positions_offsets",
              "type": "string"
            },
            "cats": {
              "properties": {
                "id": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "name": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "childs": {
                  "properties": {
                    "id": {
                      "index": "not_analyzed",
                      "type": "string"
                    },
                    "name": {
                      "index": "not_analyzed",
                      "type": "string"
                    },
                    "childs": {
                      "properties": {
                        "id": {
                          "index": "not_analyzed",
                          "type": "string"
                        },
                        "name": {
                          "index": "not_analyzed",
                          "type": "string"
                        },
                        "childs": {
                          "properties": {
                            "id": {
                              "index": "not_analyzed",
                              "type": "string"
                            },
                            "name": {
                              "index": "not_analyzed",
                              "type": "string"
                            },
                            "childs": {
                              "properties": {
                                "id": {
                                  "index": "not_analyzed",
                                  "type": "string"
                                },
                                "name": {
                                  "index": "not_analyzed",
                                  "type": "string"
                                },
                                "childs": {
                                  "properties": {
                                    "id": {
                                      "index": "not_analyzed",
                                      "type": "string"
                                    },
                                    "name": {
                                      "index": "not_analyzed",
                                      "type": "string"
                                    },
                                    "childs": {
                                      "type": "nested"
                                    }
                                  },
                                  "type": "nested"
                                }
                              },
                              "type": "nested"
                            }
                          },
                          "type": "nested"
                        }
                      },
                      "type": "nested"
                    }
                  },
                  "type": "nested"
                }
              },
              "type": "nested"
            },
            "unit": {
              "index": "not_analyzed",
              "type": "string"
            },
            "title": {
              "index_analyzer": "ansj_index",
              "store": true,
              "search_analyzer": "ansj_query",
              "boost": 2,
              "term_vector": "with_positions_offsets",
              "type": "string"
            },
            "stock": {
              "properties": {
                "count": {
                  "index": "not_analyzed",
                  "type": "long"
                },
                "status": {
                  "type": "boolean"
                },
                "name": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "regions": {
                  "properties": {
                    "count": {
                      "index": "no",
                      "type": "long"
                    },
                    "status": {
                      "type": "boolean"
                    },
                    "name": {
                      "index": "not_analyzed",
                      "type": "string"
                    }
                  }
                }
              },
              "type": "nested"
            },
            "skuId": {
              "index": "not_analyzed",
              "type": "string"
            },
            "brand": {
              "index": "not_analyzed",
              "type": "string",
              "boost": 5.0
            },
            "images": {
              "index": "no",
              "type": "string"
            },
            "salePrice": {
              "precision_step": 4,
              "type": "double"
            },
            "props": {
              "properties": {
                "name": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "value": {
                  "index": "not_analyzed",
                  "type": "string"
                }
              },
              "type": "nested"
            }
          },
          "_all": {
            "store": true,
            "analyzer": "standard",
            "auto_boost": true
          }
        }
      },
      "suggest": {
        "host": "http://192.168.65.131:9200,http://192.168.65.132:9200,http://192.168.65.136:9200",
        "index": "suggest-{adminID}-{version}",
        "type": "ProductSuggest",
        "id": "{id}",
        "mapping": {
          "properties": {
            "id": {
              "index": "not_analyzed",
              "store": true,
              "type": "string"
            },
            "name": {
              "index": "not_analyzed",
              "store": true,
              "type": "string"
            },
            "suggest": {
              "max_input_length": 50,
              "preserve_separators": true,
              "payloads": true,
              "index_analyzer": "simple",
              "search_analyzer": "simple",
              "preserve_position_increments": true,
              "type": "completion"
            }
          }
        }
      }
    },
    "data_river": {
      "rivers": [
        {
          "name": "yun_not_edit",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmpc.ItemChange",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":2)|(\"sys\":2[\\d\\D]*\"type\":\"add\")|(\"update\":\"add\"[\\d\\D]*\"sys\":2)|(\"sys\":2[\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "not",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminID": "chainMasterId\":\"(?P<adminID>[\\d\\D]+?)\"",
                "ids": "\"ids\":\"(?P<ids>[\\d\\D]+?)\""
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "192.168.65.183:2181,192.168.65.184:2181,192.168.65.185:2181",
            "service_interface": "com.qianmi.pc.api.es.item.EsGoodsQueryProvider",
            "request": {
              "method": "listByIdString",
              "timeout": 10,
              "body": {
                "chainMasterId": "{adminID}",
                "idString": "{ids}"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "product",
              "operation": "create",
              "index": "qmshop-{adminId}-{version}",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "yun_edit_add",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmpc.ItemChange",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":2)|(\"sys\":2[\\d\\D]*\"type\":\"add\")|(\"update\":\"add\"[\\d\\D]*\"sys\":2)|(\"sys\":2[\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"addSkuIds\":\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminID": "chainMasterId\":\"(?P<adminID>[\\d\\D]+?)\"",
                "ids": "\"addSkuIds\":\"(?P<ids>[\\d\\D]+?)\""
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "192.168.65.183:2181,192.168.65.184:2181,192.168.65.185:2181",
            "service_interface": "com.qianmi.pc.api.es.item.EsGoodsQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "listByIdString",
              "timeout": 10,
              "body": {
                "chainMasterId": "{adminID}",
                "idString": "{ids}"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "product",
              "operation": "create",
              "index": "qmshop-{adminId}-{version}",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "yun_edit_update",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmpc.ItemChange",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":2)|(\"sys\":2[\\d\\D]*\"type\":\"add\")|(\"update\":\"add\"[\\d\\D]*\"sys\":2)|(\"sys\":2[\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"updateSkuIds\":\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminID": "chainMasterId\":\"(?P<adminID>[\\d\\D]+?)\"",
                "ids": "\"updateSkuIds\":\"(?P<ids>[\\d\\D]+?)\""
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "dubbo",
            "host": "192.168.65.183:2181,192.168.65.184:2181,192.168.65.185:2181",
            "service_interface": "com.qianmi.pc.api.es.item.EsGoodsQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "listByIdString",
              "timeout": 10,
              "body": {
                "chainMasterId": "{adminID}",
                "idString": "{ids}"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "product",
              "operation": "create",
              "index": "qmshop-{adminId}-{version}",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "yun_edit_delete",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmpc.ItemChange",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"deleteSkuIds\":\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"sys\":2"
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminID": "chainMasterId\":\"(?P<adminID>[\\d\\D]+?)\"",
                "ids": "\"deleteSkuIds\":\"(?P<ids>[\\d\\D]+?)\""
              }
            }
          },
          "source": {
            "type": "passthrough",
            "fields_reference": "fields"
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "product",
              "operation": "delete",
              "index": "qmshop-{adminID}-{version}",
              "id": "{ids}",
              "id_process": {
                "type": "seperate",
                "separator": ":"
              }
            }
          ]
        },
        {
          "name": "yun_init",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "queue": "q.qmpc.EsInit",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"sys\":2"
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminID": "chainMasterId\":\"(?P<adminID>[\\d\\D]+?)\"",
                "fromSys": "sys\":(?P<fromSys>[\\d]+?)"
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "dubbo",
            "host": "192.168.65.183:2181,192.168.65.184:2181,192.168.65.185:2181",
            "service_interface": "com.qianmi.pc.api.es.item.EsGoodsQueryProvider",
            "version": "1.0.0",
            "request": {
              "method": "query",
              "timeout": 10,
              "body": {
                "chainMasterId": "{adminID}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "fromSys": "{fromSys}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "product",
              "operation": "create",
              "index": "qmshop-{adminId}-{version}",
              "id": "{skuId}",
              "clear_policy": "every_msg,all"
            }
          ]
        },
        {
          "name": "sup_init",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmsup.category.operate",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=init"
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {}
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "172.17.9.26:8080",
            "request": {
              "url": "/supGoods/getSupGoodsInfoPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "create",
              "id": "{skuId}",
              "clear_policy": "every_msg,all"
            }
          ]
        },
        {
          "name": "sup_show_cate_update",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmsup.category.operate",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=update"
                },
                {
                  "type": "regex",
                  "expression": "oldCateId="
                },
                {
                  "type": "regex",
                  "expression": "cateId="
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "oldCateId": "oldCateId=(?P<oldCateId>[\\d\\D]+?),",
                "cateId": "cateId=(?P<cateId>[\\d\\D]+?)}"
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "172.17.9.26:8080",
            "request": {
              "url": "/supGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "oldCateId": "{oldCateId}",
                "cateId": "{cateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "update",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_show_cate_delete",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmsup.category.operate",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=delete"
                },
                {
                  "type": "regex",
                  "expression": "cateId="
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "cateId": "cateId=(?P<cateId>[\\d\\D]+?)}"
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "172.17.9.26:8080",
            "request": {
              "url": "/supGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "cateId": "{cateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "update",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_show_cate_add",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmsup.category.operate",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=add"
                },
                {
                  "type": "regex",
                  "expression": "cateId="
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "cateId": "cateId=(?P<cateId>[\\d\\D]+?)}"
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "172.17.9.26:8080",
            "request": {
              "url": "/supGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "cateId": "{cateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "update",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_cate_update",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmsup.category.operate",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "type": "regex",
                  "expression": "method=update"
                },
                {
                  "type": "regex",
                  "expression": "oldCateId="
                },
                {
                  "type": "regex",
                  "expression": "cateId="
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "oldCateId": "oldCateId=(?P<oldCateId>[\\d\\D]+?),",
                "cateId": "cateId=(?P<cateId>[\\d\\D]+?)}"
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "172.17.9.26:8080",
            "request": {
              "url": "/supGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "oldCateId": "{oldCateId}",
                "cateId": "{cateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "update",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_not_edit",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmpc.ItemChange",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"add\")|(\"update\":\"add\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "not",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminID": "chainMasterId\":\"(?P<adminID>[\\d\\D]+?)\"",
                "skuIds": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_skuids_from_pc_mq_msg",
                  "input_param": {
                    "fields": {
                      "pc_ids": {
                        "type": "regex",
                        "expression": "\"ids\":\"(?P<pc_ids>[\\d\\D]+?)\""
                      },
                      "sep_char": {
                        "type": "fixed",
                        "expression": ","
                      }
                    }
                  }
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "http",
            "host": "172.17.9.26:8080",
            "request": {
              "url": "/supGoods/getSupGoodsInfoList",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "skuIds": "{skuIds}",
                "adminId": "{adminID}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "create",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_edit_add",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmpc.ItemChange",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"add\")|(\"update\":\"add\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"addSkuIds\":\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminID": "chainMasterId\":\"(?P<adminID>[\\d\\D]+?)\"",
                "ids": "\"addSkuIds\":\"(?P<ids>[\\d\\D]+?)\"",
                "skuIds": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_skuids_from_pc_mq_msg",
                  "input_param": {
                    "fields": {
                      "pc_ids": {
                        "type": "regex",
                        "expression": "\"addSkuIds\":\"(?P<pc_ids>[\\d\\D]+?)\""
                      },
                      "sep_char": {
                        "type": "fixed",
                        "expression": ","
                      }
                    }
                  }
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "http",
            "host": "172.17.9.26:8080",
            "request": {
              "url": "/supGoods/getSupGoodsInfoList",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "skuIds": "{skuIds}",
                "adminId": "{adminID}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "create",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_edit_update",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmpc.ItemChange",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "(\"type\":\"add\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"add\")|(\"update\":\"add\"[\\d\\D]*\"sys\":1)|(\"sys\":1[\\d\\D]*\"type\":\"update\")"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"operation\":\"edit\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"updateSkuIds\":\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminID": "chainMasterId\":\"(?P<adminID>[\\d\\D]+?)\"",
                "ids": "\"updateSkuIds\":\"(?P<ids>[\\d\\D]+?)\"",
                "skuIds": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_skuids_from_pc_mq_msg",
                  "input_param": {
                    "fields": {
                      "pc_ids": {
                        "type": "regex",
                        "expression": "\"updateSkuIds\":\"(?P<skuIds>[\\d\\D]+?)\""
                      },
                      "sep_char": {
                        "type": "fixed",
                        "expression": ","
                      }
                    }
                  }
                }
              }
            }
          },
          "source": {
            "type": "get",
            "protocol": "http",
            "host": "172.17.9.26:8080",
            "request": {
              "url": "/supGoods/getSupGoodsInfoList",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "skuIds": "{skuIds}",
                "adminId": "{adminID}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "create",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_edit_delete",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmpc.ItemChange",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"deleteSkuIds\":\""
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"sys\":1"
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "adminID": "chainMasterId\":\"(?P<adminID>[\\d\\D]+?)\"",
                "ids": "\"deleteSkuIds\":\"(?P<ids>[\\d\\D]+?)\""
              }
            }
          },
          "source": {
            "type": "passthrough",
            "fields_reference": "fields"
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "delete",
              "id": "{ids}"
            }
          ]
        },
        {
          "name": "sup_standard_cate_update",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmpc.standardCateChange",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\": \"update\"|\"type\": \"updateStatus\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "type": "\"type\":\"(?P<type>[\\d\\D]+?)\"",
                "parentCateId": "parentCateId\":\"(?P<parentCateId>[\\d\\D]+?)\"",
                "cateId": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_cateIds_from_standard_cate_update_msg"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "172.17.9.26:8080",
            "request": {
              "url": "/supGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "type": "{type}",
                "cateId": "{cateId}",
                "parentCateId": "{parentCateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "update",
              "id": "{skuId}"
            }
          ]
        },
        {
          "name": "sup_standard_cate_delete",
          "notification": {
            "type": "MQ",
            "host": "failover:(tcp://192.168.65.182:61616,tcp://192.168.65.181:61616,tcp://192.168.65.180:61616)?randomize=false",
            "topic": "t.qmpc.standardCateChange",
            "filter": {
              "union_operator": "and",
              "msg_type": "TextMessage",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "expression": "\"type\": \"delete\""
                }
              ]
            },
            "data_parser": {
              "type": "regex",
              "fields": {
                "type": "\"type\":\"(?P<type>[\\d\\D]+?)\"",
                "parentCateId": "parentCateId\":\"(?P<parentCateId>[\\d\\D]+?)\"",
                "cateId": {
                  "type": "script",
                  "language": "python",
                  "obj_path": "script_data_parsers.parse_cateIds_from_standard_cate_update_msg"
                }
              }
            }
          },
          "source": {
            "type": "iterator_get",
            "protocol": "http",
            "host": "172.17.9.26:8080",
            "request": {
              "url": "/supGoods/getSupGoodsInfoByCatIdsPagination",
              "http_method": "POST",
              "body": {
                "version": "{version}",
                "pageNum": "{page_from}",
                "pageSize": "{page_size}",
                "type": "{type}",
                "cateId": "{cateId}",
                "parentCateId": "{parentCateId}"
              }
            },
            "response": {
              "fields": {
                "total": "totalCount",
                "data": "dataList"
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch",
              "reference": "gonghuo_product",
              "operation": "update",
              "id": "{skuId}"
            }
          ]
        }
      ]
    },
    "query": {
      "chain": [
        {
          "name": "sup_product_query",
          "res_type": "product",
          "http_method": "GET",
          "url_format": "^products/gonghuo/[\\d\\D]+",
          "filter": {
            "type": "regex",
            "union_operator": "and",
            "conditions": [
              {
                "operator": "is",
                "type": "regex",
                "field": "url",
                "expression": "products/gonghuo"
              }
            ]
          },
          "data_parser": {
            "type": "regex",
            "fields": {
            }
          },
          "destination": {
            "destination_type": "elasticsearch",
            "reference": "gonghuo_product"
          },
          "response": {
            "json": {
              "format": "json",
              "data_parser": {
                "language": "python",
                "script": "script.python.data_parser"
              }
            }
          }
        },
        {
          "name": "yun_product_query",
          "res_type": "product",
          "http_method": "GET",
          "url_format": "^products/[\\d\\D]+",
          "filter": {
            "type": "regex",
            "union_operator": "and",
            "conditions": [
              {
                "operator": "is",
                "type": "regex",
                "field": "url",
                "expression": "products/[\\d\\D]+"
              }
            ]
          },
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminID": "products/(?P<adminID>[\\d\\D]+)",
              "ids": "ids=(?P<ids>[\\d\\D]+?);"
            }
          },
          "destination": {
            "destination_type": "elasticsearch",
            "reference": "product"
          },
          "response": {
            "json": {
              "format": "json",
              "data_parser": {
                "language": "python",
                "script": "script.python.data_parser"
              }
            }
          }
        },
        {
          "name": "sup_product_aggregation",
          "res_type": "aggregation",
          "http_method": "GET",
          "url_format": "^aggregations/gonghuo/[\\d\\D]+",
          "filter": {
            "type": "regex",
            "union_operator": "and",
            "conditions": [
              {
                "operator": "is",
                "type": "regex",
                "field": "url",
                "expression": "aggregations/gonghuo"
              }
            ]
          },
          "data_parser": {
            "type": "regex",
            "fields": {
            }
          },
          "destination": {
            "destination_type": "elasticsearch",
            "reference": "gonghuo_product"
          },
          "response": {
            "json": {
              "format": "json",
              "data_parser": {
                "language": "python",
                "script": "script.python.data_parser"
              }
            }
          }
        },
        {
          "name": "yun_product_aggregation",
          "res_type": "aggregation",
          "http_method": "GET",
          "url_format": "^aggregations/[\\d\\D]+",
          "filter": {
            "type": "regex",
            "union_operator": "and",
            "conditions": [
              {
                "operator": "is",
                "type": "regex",
                "field": "url",
                "expression": "aggregations/[\\d\\D]+"
              }
            ]
          },
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminID": "aggregations/(?P<adminID>[\\d\\D]+)",
              "ids": "ids=(?P<ids>[\\d\\D]+?);"
            }
          },
          "destination": {
            "destination_type": "elasticsearch",
            "reference": "product"
          },
          "response": {
            "json": {
              "format": "json",
              "data_parser": {
                "language": "python",
                "script": "script.python.data_parser"
              }
            }
          }
        },
        {
          "res_type": "suggest",
          "http_method": "GET",
          "url_format": "^suggests/[\\d\\D]+",
          "filter": {
            "type": "regex",
            "union_operator": "and",
            "conditions": [
              {
                "operator": "is",
                "type": "regex",
                "field": "url",
                "expression": "suggests/[\\d\\D]+"
              }
            ]
          },
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminID": "suggests/(?P<adminID>[\\d\\D]+)"
            }
          },
          "destination": {
            "destination_type": "elasticsearch",
            "reference": "suggest"
          },
          "response": {
            "json": {
              "format": "json",
              "data_parser": {
                "language": "python",
                "script": "script.python.data_parser"
              }
            }
          }
        },
        {
          "name": "sup_product_search",
          "res_type": "search",
          "http_method": "GET",
          "url_format": "^search/gonghuo/[\\d\\D]+",
          "filter": {
            "type": "regex",
            "union_operator": "and",
            "conditions": [
              {
                "operator": "is",
                "type": "regex",
                "field": "url",
                "expression": "search/gonghuo"
              }
            ]
          },
          "data_parser": {
            "type": "regex",
            "fields": {
            }
          },
          "destination": {
            "destination_type": "elasticsearch",
            "reference": "gonghuo_product"
          },
          "response": {
            "json": {
              "format": "json",
              "data_parser": {
                "language": "python",
                "script": "script.python.data_parser"
              }
            }
          }
        },
        {
          "name": "yun_product_search",
          "res_type": "search",
          "http_method": "GET",
          "url_format": "^search/[\\d\\D]+",
          "filter": {
            "type": "regex",
            "union_operator": "and",
            "conditions": [
              {
                "operator": "is",
                "type": "regex",
                "field": "url",
                "expression": "search/[\\d\\D]+"
              }
            ]
          },
          "data_parser": {
            "type": "regex",
            "fields": {
              "adminID": "search/(?P<adminID>[\\d\\D]+)"
            }
          },
          "destination": {
            "destination_type": "elasticsearch",
            "reference": "product"
          },
          "response": {
            "json": {
              "format": "json",
              "data_parser": {
                "language": "python",
                "script": "script.python.data_parser"
              }
            }
          }
        }
      ]
    },
    "suggest": {
      "rivers": [
        {
          "notification": {
            "name": "yun_product_suggest_task",
            "type": "elasticsearch_regularly_scan",
            "crontab": {
              "second": 0,
              "minute": 53,
              "hour": 12
            },
            "host": "http://192.168.65.131:9200,http://192.168.65.132:9200,http://192.168.65.136:9200",
            "filter": {
              "type": "es_regex",
              "union_operator": "and",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "field": "index",
                  "expression": "^qmshop-[\\d\\D]*"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "field": "type",
                  "expression": "^QmshopProduct$"
                }
              ]
            }
          },
          "source": {
            "type": "iterator_es_get",
            "size": 50,
            "data_parser": {
              "type": "map",
              "keyword_filter_regex": "^[-A-Za-z][-A-Za-z0-9]+$",
              "fields": {
                "title": "title",
                "brand": "brand",
                "category": "type"
              }
            },
            "param_parser": {
              "type": "regex",
              "fields": {
                "adminID": {
                  "field": "index",
                  "type": "regex",
                  "expression": "^qmshop-(?P<adminID>[\\d\\D]+?)$"
                }
              }
            }
          },
          "processing": {
            "type": "basic_processing",
            "output": {
              "weight": {
                "type": "script",
                "language": "mvel",
                "script": "ctx._source.suggest.weight = round(ctx._source.suggest.weight*0.5 + 0.5*current_weight)",
                "param": {
                  "type": "math_expression",
                  "fields": {
                    "current_weight": "int((hits*0.25 + source_type_weight)/2)"
                  }
                }
              },
              "payloads": {
                "type": "map",
                "fields": {
                  "source_type": "source_type",
                  "hits": "hits"
                }
              },
              "common_fields": {
                "type": "map",
                "fields": {
                  "id": "id"
                }
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch_processed",
              "reference": "suggest",
              "operation": "create"
            }
          ]
        },
        {
          "name": "sup_product_suggest_task",
          "notification": {
            "type": "elasticsearch_regularly_scan",
            "crontab": {
              "second": 0,
              "minute": 31,
              "hour": 20
            },
            "host": "http://192.168.65.131:9200,http://192.168.65.132:9200,http://192.168.65.136:9200",
            "filter": {
              "type": "es_regex",
              "union_operator": "and",
              "conditions": [
                {
                  "operator": "is",
                  "type": "regex",
                  "field": "index",
                  "expression": "^qmshop-gonghuo[\\d\\D]*"
                },
                {
                  "operator": "is",
                  "type": "regex",
                  "field": "type",
                  "expression": "^Product$"
                }
              ]
            }
          },
          "source": {
            "type": "iterator_es_get",
            "size": 50,
            "data_parser": {
              "type": "map",
              "keyword_filter_regex": "^[-A-Za-z][-A-Za-z0-9]+$",
              "fields": {
                "title": "title",
                "brand": "brand",
                "category": "type"
              }
            },
            "param_parser": {
              "type": "regex",
              "fields": {
              }
            }
          },
          "processing": {
            "type": "basic_processing",
            "output": {
              "weight": {
                "type": "script",
                "language": "mvel",
                "script": "ctx._source.suggest.weight = round(ctx._source.suggest.weight*0.5 + 0.5*current_weight)",
                "param": {
                  "type": "math_expression",
                  "fields": {
                    "current_weight": "int((hits*0.25 + source_type_weight)/2)"
                  }
                }
              },
              "payloads": {
                "type": "map",
                "fields": {
                  "source_type": "source_type",
                  "hits": "hits"
                }
              },
              "common_fields": {
                "type": "map",
                "fields": {
                  "id": "id"
                }
              }
            }
          },
          "destination": [
            {
              "destination_type": "elasticsearch_processed",
              "reference": "suggest",
              "operation": "create",
              "index": "suggest-gonghuo-{version}"
            }
          ]
        }
      ]
    },
    "consts": {
      "global": {
        "query_min_score": 1,
        "agg_size": 500,
        "query_size": {
          "from": {
            "min": 0,
            "max": 6000,
            "default": 0
          },
          "size": {
            "min": 0,
            "max": 200,
            "default": 60
          },
          "suggest_size": {
            "min": 0,
            "max": 30,
            "default": 10
          }
        }
      },
      "notification": {
        "mq_reconnect_time": 30,
        "mq_client_id": "search_platform"
      },
      "filter": {
        "default_match_result": "true"
      },
      "source": {
        "default_iteration_get_size": 50
      },
      "suggest": {
        "default_es_iterator_get_size": 100,
        "source_type": {
          "1": 1,
          "2": 10
        }
      },
      "manager": {
        "hosts": [
          {
            "host": "172.17.8.199",
            "supervisor_port": "9001",
            "supervisor_user": "user",
            "supervisor_password": "123"
          },
          {
            "host": "172.17.8.105",
            "supervisor_port": "9001",
            "supervisor_user": "user",
            "supervisor_password": "123"
          }
        ]
      },
      "logger": {
        "debug": {
          "level": "INFO"
        },
        "interface": {
          "level": "INFO"
        },
        "app": {
          "level": "INFO"
        },
        "query": {
          "level": "INFO"
        }
      }
    }
  }
}